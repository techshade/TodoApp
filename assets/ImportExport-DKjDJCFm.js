import{c as A,j as e,r as m,U as P,M as K,T as X,aE as V,x as E,ag as Y,aF as q,aG as Q,aH as W,aI as Z,a2 as ee,E as g,aJ as se,aK as x,aL as I,s as C,aM as te,ak as re,aN as ne,aO as b,K as a,aP as F,a9 as oe,aa as ae,aQ as ie}from"./index-DHRrVd1t.js";import{u as le}from"./useCtrlS-hhfr8Y4G.js";const w=A(e.jsx("path",{d:"M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"}),"FileUpload"),ce=A(e.jsx("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-.14 0-.27.01-.4.04-.39.08-.74.28-1.01.55-.18.18-.33.4-.43.64-.1.23-.16.49-.16.77v14c0 .27.06.54.16.78s.25.45.43.64c.27.27.62.47 1.01.55.13.02.26.03.4.03h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-8.7 11.88c-.39.39-1.03.39-1.42 0l-2.17-2.17a.9959.9959 0 0 1 0-1.41l2.17-2.17c.39-.39 1.03-.39 1.42 0 .39.39.39 1.02 0 1.41L8.83 12l1.46 1.46c.39.39.4 1.03.01 1.42M12 4.25c-.41 0-.75-.34-.75-.75s.34-.75.75-.75.75.34.75.75-.34.75-.75.75m1.7 10.63a.9959.9959 0 0 1 0-1.41L15.17 12l-1.47-1.47a.9959.9959 0 0 1 0-1.41c.39-.39 1.03-.39 1.42 0l2.17 2.17c.39.39.39 1.02 0 1.41l-2.17 2.17c-.39.4-1.03.4-1.42.01"}),"IntegrationInstructionsRounded"),xe=()=>{const{user:n,setUser:y}=m.useContext(P),[l,N]=K([],"tasksToExport","sessionStorage"),[M,u]=m.useState(!1),c=m.useRef(null);le(),m.useEffect(()=>{document.title="Todo App - Transfer tasks"},[]),m.useEffect(()=>{c.current&&(c.current.value="")},[n.createdAt]);const O=s=>{N(r=>r.includes(s)?r.filter(d=>d!==s):[...r,s])},D=()=>{const s=n.tasks.filter(r=>l.includes(r.id));b(s),a(e.jsxs("div",{children:["Exported tasks:"," ",e.jsx("ul",{children:s.map(r=>e.jsx("li",{children:e.jsxs(F,{children:[e.jsx(g,{unified:r.emoji||"",size:20,emojiStyle:n.emojisStyle}),e.jsx("span",{translate:"no",children:r.name})]})},r.id))})]}),{dismissButton:!0,type:"blank"})},z=()=>{b(n.tasks),a(`Exported all tasks (${n.tasks.length})`)},f=s=>{const r=s;if(r){if(r.type!=="application/json"){a(e.jsxs("div",{children:["Incorrect file type ",r.type!==""&&e.jsx("span",{translate:"no",children:r.type}),". Please select a JSON file."]}),{type:"error"});return}const d=new FileReader;d.onload=_=>{var T;try{const i=JSON.parse((T=_.target)==null?void 0:T.result);if(!Array.isArray(i)){a("Imported file has an invalid structure.",{type:"error"});return}const k=i.filter(t=>t.name&&t.name.length>oe||t.description&&t.description.length>ae||t.category&&t.category.some(h=>h.name.length>ie));if(k.length>0){const t=k.map(o=>o.name).join(", ");console.error(`These tasks cannot be imported due to exceeding maximum character lengths: ${t}`),a(`These tasks cannot be imported due to exceeding maximum character lengths: ${t}`,{type:"error"});return}const v=t=>/^#[0-9A-Fa-f]{6}$/.test(t),H=t=>t.color&&v(t.color);if(i.some(t=>t.color&&!v(t.color)||t.category&&!t.category.every(o=>H(o)))){a("Imported file contains tasks with invalid color formats.",{type:"error"});return}const S=5e4;if(r.size>S){a(`File size is too large (${r.size}/${S})`,{type:"error"});return}const j=n.categories.slice();i.forEach(t=>{t.category!==void 0&&t.category.forEach(o=>{const h=j.find(p=>p.id===o.id);h?Object.assign(h,o):j.push(o)})}),y(t=>({...t,categories:j}));const U=[...n.tasks,...i].reduce((t,o)=>t.find(p=>p.id===o.id)?t.map(p=>p.id===o.id?o:p):[...t,o],[]);y(t=>({...t,tasks:U}));const G=i.map(t=>t.name).join(", ");console.log(`Imported Tasks: ${G}`),a(e.jsxs("div",{children:["Tasks Successfully Imported from ",e.jsx("br",{}),e.jsx("i",{translate:"no",style:{wordBreak:"break-all"},children:r.name}),e.jsx("ul",{children:i.map(t=>e.jsx("li",{children:e.jsxs(F,{children:[e.jsx(g,{unified:t.emoji||"",size:20,emojiStyle:n.emojisStyle}),e.jsx("span",{translate:"no",children:t.name})]})},t.id))})]}),{dismissButton:!0,type:"blank"}),c.current&&(c.current.value="")}catch(i){console.error(`Error parsing the imported file ${r.name}:`,i),a(e.jsxs("div",{style:{wordBreak:"break-all"},children:["Error parsing the imported file: ",e.jsx("br",{})," ",e.jsx("i",{children:r.name})]}),{type:"error"}),c.current&&(c.current.value="")}},d.readAsText(r)}},L=async()=>{try{const s=await navigator.clipboard.readText();s.startsWith(`${location.protocol}//${location.hostname}`)?window.open(s,"_self"):a(e.jsx("div",{children:"Failed to import task from the provided link. Please ensure that the link is copied correctly."}),{type:"error"})}catch(s){console.error("Failed to read clipboard contents: ",s)}},$=async()=>{try{const s=await navigator.clipboard.readText(),r=new File([s],"Clipboard",{type:"application/json"});f(r)}catch(s){console.error("Failed to read clipboard contents: ",s)}},B=s=>{s.preventDefault(),s.dataTransfer.dropEffect="copy",u(!0)},J=s=>{s.preventDefault(),u(!1);const r=s.dataTransfer.files[0];if(console.log(r),r.size===0||r.type===""){a(e.jsxs("div",{children:["Unknown file type"," ",e.jsx("i",{translate:"no",style:{wordBreak:"break-all"},children:r.name})]}),{type:"error"});return}f(r)},R=s=>{const r=s.target.files&&s.target.files[0];r&&f(r)};return e.jsxs(e.Fragment,{children:[e.jsx(X,{title:"Transfer Tasks"}),e.jsxs(V,{children:["Select Tasks To Export ",e.jsx(E,{title:"Duplicates will be removed during import",children:e.jsx(Y,{style:{color:"#ffffff"},children:e.jsx(q,{})})})]}),e.jsx(Q,{children:n.tasks.length>0?n.tasks.map(s=>e.jsxs(W,{backgroundClr:s.color,onClick:()=>O(s.id),selected:l.includes(s.id),translate:"no",children:[e.jsx(Z,{color:"primary",size:"medium",checked:l.includes(s.id)}),e.jsxs(ee,{variant:"body1",component:"span",sx:{display:"flex",alignItems:"center",gap:"6px",wordBreak:"break-word"},children:[e.jsx(g,{size:24,unified:s.emoji||"",emojiStyle:n.emojisStyle})," ",s.name]})]},s.id)):e.jsx("h3",{style:{opacity:.8,fontStyle:"italic"},children:"You don't have any tasks to export"})}),e.jsxs(se,{children:[e.jsx(E,{title:l.length>0?`Selected tasks: ${new Intl.ListFormat("en",{style:"long",type:"conjunction"}).format(l.map(s=>{const r=n.tasks.find(d=>d.id===s);return r?r.name:""}))}`:void 0,children:e.jsxs(x,{onClick:D,disabled:l.length===0,children:[e.jsx(I,{}),"   Export Selected to JSON"," ",l.length>0&&`[${l.length}]`]})}),e.jsxs(x,{onClick:z,disabled:n.tasks.length===0,children:[e.jsx(I,{}),"   Export All Tasks to JSON"]}),e.jsx("h2",{style:{textAlign:"center"},children:"Import Tasks From JSON"}),C.os!=="Android"&&C.os!=="iOS"&&e.jsx("div",{style:{width:"300px"},children:e.jsxs(te,{onDragOver:B,onDragLeave:()=>u(!1),onDrop:J,isDragging:M,children:[e.jsx(w,{fontSize:"large",color:"primary"}),e.jsx("div",{children:"Drop JSON file here to import tasks "})]})}),e.jsx("input",{accept:".json",id:"import-file",type:"file",ref:c,style:{display:"none"},onChange:R}),e.jsx("label",{htmlFor:"import-file",children:e.jsxs(re,{component:"span",variant:"outlined",sx:{p:"12px 20px",borderRadius:"14px",width:"300px"},children:[e.jsx(w,{}),"   Select JSON File"]})}),e.jsxs(x,{onClick:$,children:[e.jsx(ce,{}),"   Import JSON from clipboard"]}),e.jsxs(x,{onClick:L,children:[e.jsx(ne,{}),"   Import From Link"]})]})]})};export{xe as default};
